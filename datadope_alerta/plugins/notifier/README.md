# Notifier Plugin

The Notifier plugin is designed to receive alerts, process them, and compare them to contextual rules stored in a 
database. If an alert matches one or more of these rules, the plugin will create a dictionary of information from the 
rules, ordered by priority, and insert it into the alert. This information can help users to resolve the issue 
associated with the alert.

## ContextRule Object
The ContextRule object represents a single contextual rule that is stored in the database. It has the following 
attributes:


| Field name       | Type         | Function                                                                                                                                                                                    |
|------------------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| id               | Integer      | ID of the contextual rule, used to identify it (Unique, Autogenerated)                                                                                                                      |
| name             | String       | Name of the contextual rule, used to identify it (Unique)                                                                                                                                   |
| Priority         | Integer      | An integer representing the priority of the rule. Rules with higher priority values are considered to be more important.                                                                    |
| last_check       | Boolean      | If `True`, no other rules will be compared with the alert after this one                                                                                                                    |
| contextual_rules | List\[Dict\] | A list of dictionaries containing the information that has to be present into the alert for this rule to match it (some TAG that the alert should contain, or a specific value for a field) |
| context          | Dict         | Dictionary containing the extra information to be added to the alert if this rules matches it                                                                                               |
| append_lists     | Boolean      | If `True`, the lists in the `context` dictionary will be appended to the existing ones, otherwise they will be replaced.                                                                    |


## Comparison procedure

The following considerations have to be taken into account to consider that an alert matches a rule:

* if more of one dict is provided in `contextual_rules`, if any of the dicts is matched, the rule is considered matched.
We can consider the list as a logical OR operation among rules.
* For string comparison, the string configured in the rule is considered a regex pattern. The field is considered matched
if the alert corresponding field value matches the pattern. Comparison is made case-insensitive.
* For list fields, all elements in the list must be present in the corresponding alert field. If the provided rule
is a string but the corresponding alert field is a list, the rule is considered matched if the string is in the list.

## Contextualization procedure

Dictionary in `context` is merged to alert, taking into account the following rules:

* inner dictionaries are merged recursively
* inner lists are appended if `append_lists` is `True`, otherwise they are replaced

** IMPORTANT NOTE **:
Main alert field names to be used must be the ones in json alert definition not the names 
of columns in database or the members of Alert python object.

For example, `createTime` must be used to refer to the creation time of the alert, not `create_time` or
`type` must be used to refer to the type of the alert, not `event_type`.

Some alert fields cannot be modified: 
* `id`
* `last_receive_id`
* `href`
* `history`

So, these are the modifiable fields:
* `resource`
* `event`
* `environment`
* `severity`
* `correlate`
* `status`
* `service`
* `group`
* `value`
* `text`
* `tags` (list)
* `attributes` (dict)
* `origin`
* `type`
* `createTime` (date)
* `timeout`
* `rawData`
* `customer`
* `duplicateCount`
* `repeat`
* `previousSeverity`
* `trendIndication`
* `receiveTime` (date)
* `lastReceiveTime` (date)
* `updateTime` (date)
            